---
layout: default
---
<article class="page" itemscope itemtype="https://schema.org/CreativeWork">
  <!-- Title -->
  <h1 itemprop="name">{{ page.title }}</h1>

  <!-- HERO IMAGE (clickable for lightbox) -->
  {% if page.photos and page.photos[0] %}
    <figure class="project-image" style="margin-top:.5rem;">
      <a
        class="gallery-item"
        href="{{ page.photos[0] | relative_url }}"
        data-full="{{ page.photos[0] | relative_url }}"
        data-alt="{{ page.title | escape }}"
        data-caption="{{ page.summary | escape }}"
        aria-label="Open image"
      >
        <img src="{{ page.photos[0] | relative_url }}" alt="{{ page.title }}" itemprop="image">
      </a>
    </figure>
  {% endif %}

  <!-- TAG PILLS directly under hero -->
  {% if page.tags %}
    <div class="tags" aria-label="Tags">
      {% for t in page.tags %}
        <span class="tag">{{ t }}</span>
      {% endfor %}
    </div>
  {% endif %}

  <!-- SUMMARY (lead) -->
  {% if page.summary %}
    <p class="lead" itemprop="abstract" style="margin-top:.25rem;">{{ page.summary }}</p>
  {% endif %}

  <!-- DETAIL or BODY COPY -->
  {% if page.detail %}
    <div class="content" itemprop="text">
      {{ page.detail | markdownify }}
    </div>
  {% else %}
    <div class="content" itemprop="text">
      {{ content }}
    </div>
  {% endif %}

  <!-- CTAs AFTER content -->
  {% if page.square_url or page.makerworld_url %}
    <div class="cta-row" style="margin-top:1rem;">
      {% if page.square_url %}
        <a class="btn primary" href="{{ page.square_url }}" target="_blank" rel="noopener">Buy on Square</a>
      {% endif %}
      {% if page.makerworld_url %}
        <a class="btn" href="{{ page.makerworld_url }}" target="_blank" rel="noopener">Download on Makerworld</a>
      {% endif %}
    </div>
  {% endif %}

  <!-- Additional photos grid (lightbox-enabled) -->
  {% if page.photos and page.photos.size > 1 %}
    <h2 style="margin-top:1.25rem;">Gallery</h2>
    <div class="card-grid">
      {% for p in page.photos offset:1 %}
        <div class="card">
          <a
            class="gallery-item"
            href="{{ p | relative_url }}"
            data-full="{{ p | relative_url }}"
            data-alt="{{ page.title | escape }}"
            data-caption="{{ page.summary | escape }}"
            aria-label="Open image"
          >
            <img src="{{ p | relative_url }}" alt="">
          </a>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Prev/Next within the portfolio collection -->
  {% assign items = site.portfolio | sort: 'date' %}
  {% assign curr_index = nil %}
  {% for it in items %}
    {% if it.url == page.url %}
      {% assign curr_index = forloop.index0 %}
    {% endif %}
  {% endfor %}

  {% if curr_index != nil %}
    {% assign prev_index = curr_index | minus: 1 %}
    {% assign next_index = curr_index | plus: 1 %}
    {% assign prev_item = items[prev_index] %}
    {% assign next_item = items[next_index] %}
    <nav class="pager" aria-label="Portfolio pagination" style="margin-top:1.5rem; display:flex; justify-content:space-between; gap:1rem;">
      <div>
        {% if prev_item %}
          <a class="btn" href="{{ prev_item.url | relative_url }}">← Previous</a>
        {% endif %}
      </div>
      <div>
        {% if next_item %}
          <a class="btn" href="{{ next_item.url | relative_url }}">Next →</a>
        {% endif %}
      </div>
    </nav>
  {% endif %}

{%- comment -%} RELATED PROJECTS {%- endcomment -%}
{% assign related = site.portfolio
  | where_exp: "it", "it.url != page.url"
  | where_exp: "it", "it.tags | size > 0" %}

{%- assign overlap = "" | split: "" -%}
{%- for it in related -%}
  {%- assign inter = it.tags | concat: page.tags | group_by: "." | where: "size", 2 -%}
  {%- if inter.size > 0 -%}
    {%- assign overlap = overlap | push: it -%}
  {%- endif -%}
{%- endfor -%}

{%- assign pool = overlap -%}
{%- if pool.size == 0 -%}
{%- assign pool = related -%}
{%- comment -%} fallback to any others {%- endcomment -%}
{%- endif -%}

{%- assign shown = pool
  | sort: "date" | reverse
  | slice: 0, 3 -%}

{% if shown.size > 0 %}
  <h2 style="margin-top:1.25rem;">Related Projects</h2>
  <div class="card-grid">
    {% for item in shown %}
      <article class="card">
        {% if item.photos and item.photos[0] %}
          <a class="gallery-item" href="{{ item.url | relative_url }}">
            <img src="{{ item.photos[0] | relative_url }}" alt="{{ item.title | escape }}">
          </a>
        {% endif %}
        <div class="pad">
          <h3><a href="{{ item.url | relative_url }}">{{ item.title }}</a></h3>
          {% if item.summary %}<p>{{ item.summary }}</p>{% endif %}
        </div>
      </article>
    {% endfor %}
  </div>
{% endif %}

</article>

<!-- Lightbox modal (shared with gallery styles) -->
<div class="lightbox" id="lightbox" aria-hidden="true">
  <button class="lightbox-close" aria-label="Close">×</button>
  <button class="lightbox-prev" aria-label="Previous">‹</button>
  <button class="lightbox-next" aria-label="Next">›</button>
  <div class="lightbox-inner">
    <img id="lightbox-img" alt="">
    <div class="lightbox-meta" id="lightbox-meta" hidden>
      <div class="lightbox-alt" id="lightbox-alt"></div>
      <div class="lightbox-caption" id="lightbox-caption"></div>
    </div>
  </div>
</div>

<script>
(function(){
  const lb = document.getElementById('lightbox');
  if (!lb) return;
  const img = document.getElementById('lightbox-img');
  const meta = document.getElementById('lightbox-meta');
  const altEl = document.getElementById('lightbox-alt');
  const capEl = document.getElementById('lightbox-caption');
  const closeBtn = lb.querySelector('.lightbox-close');
  const prevBtn = lb.querySelector('.lightbox-prev');
  const nextBtn = lb.querySelector('.lightbox-next');

  // Collect all gallery anchors on the page, in order
  const items = Array.from(document.querySelectorAll('.gallery-item'));
  let currentIndex = -1;

  function renderFromIndex(i){
    if (i < 0 || i >= items.length) return;
    currentIndex = i;
    const a = items[i];
    const src = a.getAttribute('data-full') || a.getAttribute('href');
    const alt = a.getAttribute('data-alt') || '';
    const cap = a.getAttribute('data-caption') || '';
    img.src = src;
    img.alt = alt;
    const hasAlt = !!(alt && alt.trim().length);
    const hasCap = !!(cap && cap.trim().length);
    altEl.textContent = hasAlt ? alt : '';
    capEl.textContent = hasCap ? cap : '';
    meta.hidden = !(hasAlt || hasCap);
    lb.classList.add('open');
    lb.setAttribute('aria-hidden','false');
    prevBtn.disabled = (currentIndex <= 0);
    nextBtn.disabled = (currentIndex >= items.length - 1);
  }

  function openFromAnchor(a){
    const i = items.indexOf(a);
    if (i !== -1) renderFromIndex(i);
  }

  function closeLB(){
    lb.classList.remove('open');
    lb.setAttribute('aria-hidden','true');
    img.removeAttribute('src');
    img.removeAttribute('alt');
    meta.hidden = true;
    altEl.textContent = '';
    capEl.textContent = '';
    currentIndex = -1;
  }

  function showPrev(){ if (currentIndex > 0) renderFromIndex(currentIndex - 1); }
  function showNext(){ if (currentIndex < items.length - 1) renderFromIndex(currentIndex + 1); }

  // Open on click
  document.addEventListener('click', function(e){
    const a = e.target.closest('.gallery-item');
    if (a){
      e.preventDefault();
      openFromAnchor(a);
    }
  });

  // Overlay interactions
  lb.addEventListener('click', function(e){
    if (!e.target.closest('.lightbox-inner')) closeLB();
  });
  closeBtn.addEventListener('click', closeLB);
  prevBtn.addEventListener('click', function(e){ e.stopPropagation(); showPrev(); });
  nextBtn.addEventListener('click', function(e){ e.stopPropagation(); showNext(); });

  // Keyboard
  document.addEventListener('keydown', function(e){
    if (!lb.classList.contains('open')) return;
    if (e.key === 'Escape') closeLB();
    else if (e.key === 'ArrowLeft') showPrev();
    else if (e.key === 'ArrowRight') showNext();
  });
})();
</script>